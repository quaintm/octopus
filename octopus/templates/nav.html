{% macro render_nav_item(item) %}
    <li class="{{ 'active' if item.is_active else '' }}"><a href="{{ item.url }}">{{ item.label|safe }}</a></li>
{% endmacro %}

{% macro render_nav_items(parent, is_top=false) %}
    {% if parent.items %}
        {% if is_top %}
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown"
               role="button" aria-expanded="false">{{ parent.label|safe }}</a>
            <ul class="dropdown-menu" role="menu">
        {% else %}
            <li class="dropdown-submenu">
            <a href="{{ parent.url if parent.url else '#' }}" tabindex="-1">{{ parent.label }}</a>
            <ul class="dropdown-menu">
        {% endif %}
        {% for item in parent.items %}
            {% if item.items %}
                {{ render_nav_items(item) }}
            {% else %}
                {{ render_nav_item(item) }}
            {% endif %}
        {% endfor %}
        </ul></li>
    {% else %}
        {{ render_nav_item(parent) }}
    {% endif %}
{% endmacro %}


<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">

  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <h4>
        <a class="navbar-brand" href="{{ url_for('public.home') }}">octopus</a>
    </h4>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse navbar-ex1-collapse">
    <ul class="nav navbar-nav">
        {% for item in nav.public %}
            {{ render_nav_items(item, true) }}
        {% endfor %}
        {% for item in nav.user %}
            {{ render_nav_items(item, true) }}
        {% endfor %}
        {% for item in nav.case %}
            {{ render_nav_items(item, true) }}
        {% endfor %}
    </ul>
    {% if current_user and current_user.is_authenticated() %}
    <ul class="nav navbar-nav navbar-right">
        <li>
            <a class="navbar-link" href="{{ url_for('user.members') }}"><h4>Hello, {{ current_user.username }}</h4></a>
        </li>
        <li><a class="navbar-link" href="{{ url_for('public.logout') }}"><h4><i class="fa fa-sign-out"></i></h4></a></li>

    </ul>
    {% elif form %}
    <ul class="nav navbar-nav navbar-right">
      <li><a href="{{ url_for('public.register') }}">Create account</a></li>
    </ul>
    <form id="loginForm" method="POST" class="navbar-form form-inline navbar-right" action="/" role="login">
      {{ form.hidden_tag() }}
      <div class="form-group">
        {{ form.username(placeholder="Username", class_="form-control") }}
        {{ form.password(placeholder="Password", class_="form-control") }}
      </div>
      <button type="submit" class="btn btn-default">Log in</button>
    </form>
    {% endif %}
  </div><!-- /.navbar-collapse -->
  </div><!-- /.container -->
</nav>

